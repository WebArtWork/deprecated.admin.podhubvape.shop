import{a as Bt}from"./chunk-LVMI42ZP.js";import{a as Ie}from"./chunk-DZVV4JSR.js";import{a as At}from"./chunk-YE5FV3IB.js";import{g as xt}from"./chunk-C3S2QHG2.js";import"./chunk-TGKOXAGH.js";import{A as ft,C as b,D as C,G as dt,H as F,J as E,Ka as _t,La as re,M as mt,N as gt,O as w,P as y,Q as Ce,Ra as _e,T as we,U as P,V as M,Xa as N,Ya as $,Z as pt,_a as D,ca as _,d as m,da as H,db as Ee,e as Yn,ea as ne,eb as ve,f as ct,gb as Se,jb as It,kb as Et,l as W,lb as vt,m as de,mb as St,n as A,na as Ct,o as B,p as me,pb as bt,q as ut,qb as Tt,s as ht,t as ge,u as pe,ua as ye,va as wt,xa as yt}from"./chunk-2AZ5U4IF.js";var Pt=m((ci,Lt)=>{"use strict";Lt.exports=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}});var U=m(O=>{"use strict";var Ue,Zn=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];O.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};O.getSymbolTotalCodewords=function(e){return Zn[e]};O.getBCHDigit=function(r){let e=0;for(;r!==0;)e++,r>>>=1;return e};O.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Ue=e};O.isKanjiModeEnabled=function(){return typeof Ue<"u"};O.toSJIS=function(e){return Ue(e)}});var be=m(T=>{"use strict";T.L={bit:1};T.M={bit:0};T.Q={bit:3};T.H={bit:2};function Xn(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return T.L;case"m":case"medium":return T.M;case"q":case"quartile":return T.Q;case"h":case"high":return T.H;default:throw new Error("Unknown EC Level: "+r)}}T.isValid=function(e){return e&&typeof e.bit<"u"&&e.bit>=0&&e.bit<4};T.from=function(e,n){if(T.isValid(e))return e;try{return Xn(e)}catch{return n}}});var Dt=m((fi,Ft)=>{"use strict";function qt(){this.buffer=[],this.length=0}qt.prototype={get:function(r){let e=Math.floor(r/8);return(this.buffer[e]>>>7-r%8&1)===1},put:function(r,e){for(let n=0;n<e;n++)this.putBit((r>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){let e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),r&&(this.buffer[e]|=128>>>this.length%8),this.length++}};Ft.exports=qt});var Ut=m((di,kt)=>{"use strict";function oe(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}oe.prototype.set=function(r,e,n,t){let i=r*this.size+e;this.data[i]=n,t&&(this.reservedBit[i]=!0)};oe.prototype.get=function(r,e){return this.data[r*this.size+e]};oe.prototype.xor=function(r,e,n){this.data[r*this.size+e]^=n};oe.prototype.isReserved=function(r,e){return this.reservedBit[r*this.size+e]};kt.exports=oe});var jt=m(Te=>{"use strict";var er=U().getSymbolSize;Te.getRowColCoords=function(e){if(e===1)return[];let n=Math.floor(e/7)+2,t=er(e),i=t===145?26:Math.ceil((t-13)/(2*n-2))*2,o=[t-7];for(let s=1;s<n-1;s++)o[s]=o[s-1]-i;return o.push(6),o.reverse()};Te.getPositions=function(e){let n=[],t=Te.getRowColCoords(e),i=t.length;for(let o=0;o<i;o++)for(let s=0;s<i;s++)o===0&&s===0||o===0&&s===i-1||o===i-1&&s===0||n.push([t[o],t[s]]);return n}});var Ht=m(zt=>{"use strict";var tr=U().getSymbolSize,Vt=7;zt.getPositions=function(e){let n=tr(e);return[[0,0],[n-Vt,0],[0,n-Vt]]}});var Ot=m(g=>{"use strict";g.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var J={N1:3,N2:3,N3:40,N4:10};g.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7};g.from=function(e){return g.isValid(e)?parseInt(e,10):void 0};g.getPenaltyN1=function(e){let n=e.size,t=0,i=0,o=0,s=null,a=null;for(let l=0;l<n;l++){i=o=0,s=a=null;for(let c=0;c<n;c++){let u=e.get(l,c);u===s?i++:(i>=5&&(t+=J.N1+(i-5)),s=u,i=1),u=e.get(c,l),u===a?o++:(o>=5&&(t+=J.N1+(o-5)),a=u,o=1)}i>=5&&(t+=J.N1+(i-5)),o>=5&&(t+=J.N1+(o-5))}return t};g.getPenaltyN2=function(e){let n=e.size,t=0;for(let i=0;i<n-1;i++)for(let o=0;o<n-1;o++){let s=e.get(i,o)+e.get(i,o+1)+e.get(i+1,o)+e.get(i+1,o+1);(s===4||s===0)&&t++}return t*J.N2};g.getPenaltyN3=function(e){let n=e.size,t=0,i=0,o=0;for(let s=0;s<n;s++){i=o=0;for(let a=0;a<n;a++)i=i<<1&2047|e.get(s,a),a>=10&&(i===1488||i===93)&&t++,o=o<<1&2047|e.get(a,s),a>=10&&(o===1488||o===93)&&t++}return t*J.N3};g.getPenaltyN4=function(e){let n=0,t=e.data.length;for(let o=0;o<t;o++)n+=e.data[o];return Math.abs(Math.ceil(n*100/t/5)-10)*J.N4};function nr(r,e,n){switch(r){case g.Patterns.PATTERN000:return(e+n)%2===0;case g.Patterns.PATTERN001:return e%2===0;case g.Patterns.PATTERN010:return n%3===0;case g.Patterns.PATTERN011:return(e+n)%3===0;case g.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(n/3))%2===0;case g.Patterns.PATTERN101:return e*n%2+e*n%3===0;case g.Patterns.PATTERN110:return(e*n%2+e*n%3)%2===0;case g.Patterns.PATTERN111:return(e*n%3+(e+n)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}g.applyMask=function(e,n){let t=n.size;for(let i=0;i<t;i++)for(let o=0;o<t;o++)n.isReserved(o,i)||n.xor(o,i,nr(e,o,i))};g.getBestMask=function(e,n){let t=Object.keys(g.Patterns).length,i=0,o=1/0;for(let s=0;s<t;s++){n(s),g.applyMask(s,e);let a=g.getPenaltyN1(e)+g.getPenaltyN2(e)+g.getPenaltyN3(e)+g.getPenaltyN4(e);g.applyMask(s,e),a<o&&(o=a,i=s)}return i}});var Ve=m(je=>{"use strict";var j=be(),xe=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Ae=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];je.getBlocksCount=function(e,n){switch(n){case j.L:return xe[(e-1)*4+0];case j.M:return xe[(e-1)*4+1];case j.Q:return xe[(e-1)*4+2];case j.H:return xe[(e-1)*4+3];default:return}};je.getTotalCodewordsCount=function(e,n){switch(n){case j.L:return Ae[(e-1)*4+0];case j.M:return Ae[(e-1)*4+1];case j.Q:return Ae[(e-1)*4+2];case j.H:return Ae[(e-1)*4+3];default:return}}});var Jt=m(Me=>{"use strict";var se=new Uint8Array(512),Be=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)se[n]=e,Be[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)se[n]=se[n-255]})();Me.log=function(e){if(e<1)throw new Error("log("+e+")");return Be[e]};Me.exp=function(e){return se[e]};Me.mul=function(e,n){return e===0||n===0?0:se[Be[e]+Be[n]]}});var Kt=m(ae=>{"use strict";var ze=Jt();ae.mul=function(e,n){let t=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let o=0;o<n.length;o++)t[i+o]^=ze.mul(e[i],n[o]);return t};ae.mod=function(e,n){let t=new Uint8Array(e);for(;t.length-n.length>=0;){let i=t[0];for(let s=0;s<n.length;s++)t[s]^=ze.mul(n[s],i);let o=0;for(;o<t.length&&t[o]===0;)o++;t=t.slice(o)}return t};ae.generateECPolynomial=function(e){let n=new Uint8Array([1]);for(let t=0;t<e;t++)n=ae.mul(n,new Uint8Array([1,ze.exp(t)]));return n}});var Wt=m((_i,Gt)=>{"use strict";var Yt=Kt();function He(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}He.prototype.initialize=function(e){this.degree=e,this.genPoly=Yt.generateECPolynomial(this.degree)};He.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");let n=new Uint8Array(e.length+this.degree);n.set(e);let t=Yt.mod(n,this.genPoly),i=this.degree-t.length;if(i>0){let o=new Uint8Array(this.degree);return o.set(t,i),o}return t};Gt.exports=He});var Oe=m($t=>{"use strict";$t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}});var Je=m(q=>{"use strict";var Qt="[0-9]+",rr="[A-Z $%*+\\-./:]+",le="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";le=le.replace(/u/g,"\\u");var ir="(?:(?![A-Z0-9 $%*+\\-./:]|"+le+`)(?:.|[\r
]))+`;q.KANJI=new RegExp(le,"g");q.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");q.BYTE=new RegExp(ir,"g");q.NUMERIC=new RegExp(Qt,"g");q.ALPHANUMERIC=new RegExp(rr,"g");var or=new RegExp("^"+le+"$"),sr=new RegExp("^"+Qt+"$"),ar=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");q.testKanji=function(e){return or.test(e)};q.testNumeric=function(e){return sr.test(e)};q.testAlphanumeric=function(e){return ar.test(e)}});var V=m(I=>{"use strict";var lr=Oe(),Ke=Je();I.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]};I.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]};I.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]};I.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]};I.MIXED={bit:-1};I.getCharCountIndicator=function(e,n){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!lr.isValid(n))throw new Error("Invalid version: "+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]};I.getBestModeForData=function(e){return Ke.testNumeric(e)?I.NUMERIC:Ke.testAlphanumeric(e)?I.ALPHANUMERIC:Ke.testKanji(e)?I.KANJI:I.BYTE};I.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")};I.isValid=function(e){return e&&e.bit&&e.ccBits};function cr(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return I.NUMERIC;case"alphanumeric":return I.ALPHANUMERIC;case"kanji":return I.KANJI;case"byte":return I.BYTE;default:throw new Error("Unknown mode: "+r)}}I.from=function(e,n){if(I.isValid(e))return e;try{return cr(e)}catch{return n}}});var nn=m(K=>{"use strict";var Ne=U(),ur=Ve(),Zt=be(),z=V(),Ye=Oe(),en=7973,Xt=Ne.getBCHDigit(en);function hr(r,e,n){for(let t=1;t<=40;t++)if(e<=K.getCapacity(t,n,r))return t}function tn(r,e){return z.getCharCountIndicator(r,e)+4}function fr(r,e){let n=0;return r.forEach(function(t){let i=tn(t.mode,e);n+=i+t.getBitsLength()}),n}function dr(r,e){for(let n=1;n<=40;n++)if(fr(r,n)<=K.getCapacity(n,e,z.MIXED))return n}K.from=function(e,n){return Ye.isValid(e)?parseInt(e,10):n};K.getCapacity=function(e,n,t){if(!Ye.isValid(e))throw new Error("Invalid QR Code version");typeof t>"u"&&(t=z.BYTE);let i=Ne.getSymbolTotalCodewords(e),o=ur.getTotalCodewordsCount(e,n),s=(i-o)*8;if(t===z.MIXED)return s;let a=s-tn(t,e);switch(t){case z.NUMERIC:return Math.floor(a/10*3);case z.ALPHANUMERIC:return Math.floor(a/11*2);case z.KANJI:return Math.floor(a/13);case z.BYTE:default:return Math.floor(a/8)}};K.getBestVersionForData=function(e,n){let t,i=Zt.from(n,Zt.M);if(Array.isArray(e)){if(e.length>1)return dr(e,i);if(e.length===0)return 1;t=e[0]}else t=e;return hr(t.mode,t.getLength(),i)};K.getEncodedBits=function(e){if(!Ye.isValid(e)||e<7)throw new Error("Invalid QR Code version");let n=e<<12;for(;Ne.getBCHDigit(n)-Xt>=0;)n^=en<<Ne.getBCHDigit(n)-Xt;return e<<12|n}});var an=m(sn=>{"use strict";var Ge=U(),on=1335,mr=21522,rn=Ge.getBCHDigit(on);sn.getEncodedBits=function(e,n){let t=e.bit<<3|n,i=t<<10;for(;Ge.getBCHDigit(i)-rn>=0;)i^=on<<Ge.getBCHDigit(i)-rn;return(t<<10|i)^mr}});var cn=m((Ti,ln)=>{"use strict";var gr=V();function Q(r){this.mode=gr.NUMERIC,this.data=r.toString()}Q.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};Q.prototype.getLength=function(){return this.data.length};Q.prototype.getBitsLength=function(){return Q.getBitsLength(this.data.length)};Q.prototype.write=function(e){let n,t,i;for(n=0;n+3<=this.data.length;n+=3)t=this.data.substr(n,3),i=parseInt(t,10),e.put(i,10);let o=this.data.length-n;o>0&&(t=this.data.substr(n),i=parseInt(t,10),e.put(i,o*3+1))};ln.exports=Q});var hn=m((xi,un)=>{"use strict";var pr=V(),We=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Z(r){this.mode=pr.ALPHANUMERIC,this.data=r}Z.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Z.prototype.getLength=function(){return this.data.length};Z.prototype.getBitsLength=function(){return Z.getBitsLength(this.data.length)};Z.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let t=We.indexOf(this.data[n])*45;t+=We.indexOf(this.data[n+1]),e.put(t,11)}this.data.length%2&&e.put(We.indexOf(this.data[n]),6)};un.exports=Z});var dn=m((Ai,fn)=>{"use strict";fn.exports=function(e){for(var n=[],t=e.length,i=0;i<t;i++){var o=e.charCodeAt(i);if(o>=55296&&o<=56319&&t>i+1){var s=e.charCodeAt(i+1);s>=56320&&s<=57343&&(o=(o-55296)*1024+s-56320+65536,i+=1)}if(o<128){n.push(o);continue}if(o<2048){n.push(o>>6|192),n.push(o&63|128);continue}if(o<55296||o>=57344&&o<65536){n.push(o>>12|224),n.push(o>>6&63|128),n.push(o&63|128);continue}if(o>=65536&&o<=1114111){n.push(o>>18|240),n.push(o>>12&63|128),n.push(o>>6&63|128),n.push(o&63|128);continue}n.push(239,191,189)}return new Uint8Array(n).buffer}});var gn=m((Bi,mn)=>{"use strict";var Cr=dn(),wr=V();function X(r){this.mode=wr.BYTE,typeof r=="string"&&(r=Cr(r)),this.data=new Uint8Array(r)}X.getBitsLength=function(e){return e*8};X.prototype.getLength=function(){return this.data.length};X.prototype.getBitsLength=function(){return X.getBitsLength(this.data.length)};X.prototype.write=function(r){for(let e=0,n=this.data.length;e<n;e++)r.put(this.data[e],8)};mn.exports=X});var Cn=m((Mi,pn)=>{"use strict";var yr=V(),_r=U();function ee(r){this.mode=yr.KANJI,this.data=r}ee.getBitsLength=function(e){return e*13};ee.prototype.getLength=function(){return this.data.length};ee.prototype.getBitsLength=function(){return ee.getBitsLength(this.data.length)};ee.prototype.write=function(r){let e;for(e=0;e<this.data.length;e++){let n=_r.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),r.put(n,13)}};pn.exports=ee});var wn=m((Ni,$e)=>{"use strict";var ce={single_source_shortest_paths:function(r,e,n){var t={},i={};i[e]=0;var o=ce.PriorityQueue.make();o.push(e,0);for(var s,a,l,c,u,p,f,v,x;!o.empty();){s=o.pop(),a=s.value,c=s.cost,u=r[a]||{};for(l in u)u.hasOwnProperty(l)&&(p=u[l],f=c+p,v=i[l],x=typeof i[l]>"u",(x||v>f)&&(i[l]=f,o.push(l,f),t[l]=a))}if(typeof n<"u"&&typeof i[n]>"u"){var h=["Could not find a path from ",e," to ",n,"."].join("");throw new Error(h)}return t},extract_shortest_path_from_predecessor_list:function(r,e){for(var n=[],t=e,i;t;)n.push(t),i=r[t],t=r[t];return n.reverse(),n},find_path:function(r,e,n){var t=ce.single_source_shortest_paths(r,e,n);return ce.extract_shortest_path_from_predecessor_list(t,n)},PriorityQueue:{make:function(r){var e=ce.PriorityQueue,n={},t;r=r||{};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n.queue=[],n.sorter=r.sorter||e.default_sorter,n},default_sorter:function(r,e){return r.cost-e.cost},push:function(r,e){var n={value:r,cost:e};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};typeof $e<"u"&&($e.exports=ce)});var Tn=m(te=>{"use strict";var d=V(),In=cn(),En=hn(),vn=gn(),Sn=Cn(),ue=Je(),Re=U(),Ir=wn();function yn(r){return unescape(encodeURIComponent(r)).length}function he(r,e,n){let t=[],i;for(;(i=r.exec(n))!==null;)t.push({data:i[0],index:i.index,mode:e,length:i[0].length});return t}function bn(r){let e=he(ue.NUMERIC,d.NUMERIC,r),n=he(ue.ALPHANUMERIC,d.ALPHANUMERIC,r),t,i;return Re.isKanjiModeEnabled()?(t=he(ue.BYTE,d.BYTE,r),i=he(ue.KANJI,d.KANJI,r)):(t=he(ue.BYTE_KANJI,d.BYTE,r),i=[]),e.concat(n,t,i).sort(function(s,a){return s.index-a.index}).map(function(s){return{data:s.data,mode:s.mode,length:s.length}})}function Qe(r,e){switch(e){case d.NUMERIC:return In.getBitsLength(r);case d.ALPHANUMERIC:return En.getBitsLength(r);case d.KANJI:return Sn.getBitsLength(r);case d.BYTE:return vn.getBitsLength(r)}}function Er(r){return r.reduce(function(e,n){let t=e.length-1>=0?e[e.length-1]:null;return t&&t.mode===n.mode?(e[e.length-1].data+=n.data,e):(e.push(n),e)},[])}function vr(r){let e=[];for(let n=0;n<r.length;n++){let t=r[n];switch(t.mode){case d.NUMERIC:e.push([t,{data:t.data,mode:d.ALPHANUMERIC,length:t.length},{data:t.data,mode:d.BYTE,length:t.length}]);break;case d.ALPHANUMERIC:e.push([t,{data:t.data,mode:d.BYTE,length:t.length}]);break;case d.KANJI:e.push([t,{data:t.data,mode:d.BYTE,length:yn(t.data)}]);break;case d.BYTE:e.push([{data:t.data,mode:d.BYTE,length:yn(t.data)}])}}return e}function Sr(r,e){let n={},t={start:{}},i=["start"];for(let o=0;o<r.length;o++){let s=r[o],a=[];for(let l=0;l<s.length;l++){let c=s[l],u=""+o+l;a.push(u),n[u]={node:c,lastCount:0},t[u]={};for(let p=0;p<i.length;p++){let f=i[p];n[f]&&n[f].node.mode===c.mode?(t[f][u]=Qe(n[f].lastCount+c.length,c.mode)-Qe(n[f].lastCount,c.mode),n[f].lastCount+=c.length):(n[f]&&(n[f].lastCount=c.length),t[f][u]=Qe(c.length,c.mode)+4+d.getCharCountIndicator(c.mode,e))}}i=a}for(let o=0;o<i.length;o++)t[i[o]].end=0;return{map:t,table:n}}function _n(r,e){let n,t=d.getBestModeForData(r);if(n=d.from(e,t),n!==d.BYTE&&n.bit<t.bit)throw new Error('"'+r+'" cannot be encoded with mode '+d.toString(n)+`.
 Suggested mode is: `+d.toString(t));switch(n===d.KANJI&&!Re.isKanjiModeEnabled()&&(n=d.BYTE),n){case d.NUMERIC:return new In(r);case d.ALPHANUMERIC:return new En(r);case d.KANJI:return new Sn(r);case d.BYTE:return new vn(r)}}te.fromArray=function(e){return e.reduce(function(n,t){return typeof t=="string"?n.push(_n(t,null)):t.data&&n.push(_n(t.data,t.mode)),n},[])};te.fromString=function(e,n){let t=bn(e,Re.isKanjiModeEnabled()),i=vr(t),o=Sr(i,n),s=Ir.find_path(o.map,"start","end"),a=[];for(let l=1;l<s.length-1;l++)a.push(o.table[s[l]].node);return te.fromArray(Er(a))};te.rawSplit=function(e){return te.fromArray(bn(e,Re.isKanjiModeEnabled()))}});var An=m(xn=>{"use strict";var Pe=U(),Ze=be(),br=Dt(),Tr=Ut(),xr=jt(),Ar=Ht(),tt=Ot(),nt=Ve(),Br=Wt(),Le=nn(),Mr=an(),Nr=V(),Xe=Tn();function Rr(r,e){let n=r.size,t=Ar.getPositions(e);for(let i=0;i<t.length;i++){let o=t[i][0],s=t[i][1];for(let a=-1;a<=7;a++)if(!(o+a<=-1||n<=o+a))for(let l=-1;l<=7;l++)s+l<=-1||n<=s+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?r.set(o+a,s+l,!0,!0):r.set(o+a,s+l,!1,!0))}}function Lr(r){let e=r.size;for(let n=8;n<e-8;n++){let t=n%2===0;r.set(n,6,t,!0),r.set(6,n,t,!0)}}function Pr(r,e){let n=xr.getPositions(e);for(let t=0;t<n.length;t++){let i=n[t][0],o=n[t][1];for(let s=-2;s<=2;s++)for(let a=-2;a<=2;a++)s===-2||s===2||a===-2||a===2||s===0&&a===0?r.set(i+s,o+a,!0,!0):r.set(i+s,o+a,!1,!0)}}function qr(r,e){let n=r.size,t=Le.getEncodedBits(e),i,o,s;for(let a=0;a<18;a++)i=Math.floor(a/3),o=a%3+n-8-3,s=(t>>a&1)===1,r.set(i,o,s,!0),r.set(o,i,s,!0)}function et(r,e,n){let t=r.size,i=Mr.getEncodedBits(e,n),o,s;for(o=0;o<15;o++)s=(i>>o&1)===1,o<6?r.set(o,8,s,!0):o<8?r.set(o+1,8,s,!0):r.set(t-15+o,8,s,!0),o<8?r.set(8,t-o-1,s,!0):o<9?r.set(8,15-o-1+1,s,!0):r.set(8,15-o-1,s,!0);r.set(t-8,8,1,!0)}function Fr(r,e){let n=r.size,t=-1,i=n-1,o=7,s=0;for(let a=n-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!r.isReserved(i,a-l)){let c=!1;s<e.length&&(c=(e[s]>>>o&1)===1),r.set(i,a-l,c),o--,o===-1&&(s++,o=7)}if(i+=t,i<0||n<=i){i-=t,t=-t;break}}}function Dr(r,e,n){let t=new br;n.forEach(function(l){t.put(l.mode.bit,4),t.put(l.getLength(),Nr.getCharCountIndicator(l.mode,r)),l.write(t)});let i=Pe.getSymbolTotalCodewords(r),o=nt.getTotalCodewordsCount(r,e),s=(i-o)*8;for(t.getLengthInBits()+4<=s&&t.put(0,4);t.getLengthInBits()%8!==0;)t.putBit(0);let a=(s-t.getLengthInBits())/8;for(let l=0;l<a;l++)t.put(l%2?17:236,8);return kr(t,r,e)}function kr(r,e,n){let t=Pe.getSymbolTotalCodewords(e),i=nt.getTotalCodewordsCount(e,n),o=t-i,s=nt.getBlocksCount(e,n),a=t%s,l=s-a,c=Math.floor(t/s),u=Math.floor(o/s),p=u+1,f=c-u,v=new Br(f),x=0,h=new Array(s),S=new Array(s),Fe=0,Kn=new Uint8Array(r.buffer);for(let G=0;G<s;G++){let ke=G<l?u:p;h[G]=Kn.slice(x,x+ke),S[G]=v.encode(h[G]),x+=ke,Fe=Math.max(Fe,ke)}let De=new Uint8Array(t),lt=0,R,L;for(R=0;R<Fe;R++)for(L=0;L<s;L++)R<h[L].length&&(De[lt++]=h[L][R]);for(R=0;R<f;R++)for(L=0;L<s;L++)De[lt++]=S[L][R];return De}function Ur(r,e,n,t){let i;if(Array.isArray(r))i=Xe.fromArray(r);else if(typeof r=="string"){let c=e;if(!c){let u=Xe.rawSplit(r);c=Le.getBestVersionForData(u,n)}i=Xe.fromString(r,c||40)}else throw new Error("Invalid data");let o=Le.getBestVersionForData(i,n);if(!o)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=o;else if(e<o)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+o+`.
`);let s=Dr(e,n,i),a=Pe.getSymbolSize(e),l=new Tr(a);return Rr(l,e),Lr(l),Pr(l,e),et(l,n,0),e>=7&&qr(l,e),Fr(l,s),isNaN(t)&&(t=tt.getBestMask(l,et.bind(null,l,n))),tt.applyMask(t,l),et(l,n,t),{modules:l,version:e,errorCorrectionLevel:n,maskPattern:t,segments:i}}xn.create=function(e,n){if(typeof e>"u"||e==="")throw new Error("No input text");let t=Ze.M,i,o;return typeof n<"u"&&(t=Ze.from(n.errorCorrectionLevel,Ze.M),i=Le.from(n.version),o=tt.from(n.maskPattern),n.toSJISFunc&&Pe.setToSJISFunction(n.toSJISFunc)),Ur(e,i,t,o)}});var rt=m(Y=>{"use strict";function Bn(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let e=r.slice().replace("#","").split("");if(e.length<3||e.length===5||e.length>8)throw new Error("Invalid hex color: "+r);(e.length===3||e.length===4)&&(e=Array.prototype.concat.apply([],e.map(function(t){return[t,t]}))),e.length===6&&e.push("F","F");let n=parseInt(e.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:"#"+e.slice(0,6).join("")}}Y.getOptions=function(e){e||(e={}),e.color||(e.color={});let n=typeof e.margin>"u"||e.margin===null||e.margin<0?4:e.margin,t=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:t,scale:t?4:i,margin:n,color:{dark:Bn(e.color.dark||"#000000ff"),light:Bn(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}};Y.getScale=function(e,n){return n.width&&n.width>=e+n.margin*2?n.width/(e+n.margin*2):n.scale};Y.getImageWidth=function(e,n){let t=Y.getScale(e,n);return Math.floor((e+n.margin*2)*t)};Y.qrToImageData=function(e,n,t){let i=n.modules.size,o=n.modules.data,s=Y.getScale(i,t),a=Math.floor((i+t.margin*2)*s),l=t.margin*s,c=[t.color.light,t.color.dark];for(let u=0;u<a;u++)for(let p=0;p<a;p++){let f=(u*a+p)*4,v=t.color.light;if(u>=l&&p>=l&&u<a-l&&p<a-l){let x=Math.floor((u-l)/s),h=Math.floor((p-l)/s);v=c[o[x*i+h]?1:0]}e[f++]=v.r,e[f++]=v.g,e[f++]=v.b,e[f]=v.a}}});var Mn=m(qe=>{"use strict";var it=rt();function jr(r,e,n){r.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=n,e.width=n,e.style.height=n+"px",e.style.width=n+"px"}function Vr(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}qe.render=function(e,n,t){let i=t,o=n;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),n||(o=Vr()),i=it.getOptions(i);let s=it.getImageWidth(e.modules.size,i),a=o.getContext("2d"),l=a.createImageData(s,s);return it.qrToImageData(l.data,e,i),jr(a,o,s),a.putImageData(l,0,0),o};qe.renderToDataURL=function(e,n,t){let i=t;typeof i>"u"&&(!n||!n.getContext)&&(i=n,n=void 0),i||(i={});let o=qe.render(e,n,i),s=i.type||"image/png",a=i.rendererOpts||{};return o.toDataURL(s,a.quality)}});var Ln=m(Rn=>{"use strict";var zr=rt();function Nn(r,e){let n=r.a/255,t=e+'="'+r.hex+'"';return n<1?t+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':t}function ot(r,e,n){let t=r+e;return typeof n<"u"&&(t+=" "+n),t}function Hr(r,e,n){let t="",i=0,o=!1,s=0;for(let a=0;a<r.length;a++){let l=Math.floor(a%e),c=Math.floor(a/e);!l&&!o&&(o=!0),r[a]?(s++,a>0&&l>0&&r[a-1]||(t+=o?ot("M",l+n,.5+c+n):ot("m",i,0),i=0,o=!1),l+1<e&&r[a+1]||(t+=ot("h",s),s=0)):i++}return t}Rn.render=function(e,n,t){let i=zr.getOptions(n),o=e.modules.size,s=e.modules.data,a=o+i.margin*2,l=i.color.light.a?"<path "+Nn(i.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",c="<path "+Nn(i.color.dark,"stroke")+' d="'+Hr(s,o,i.margin)+'"/>',u='viewBox="0 0 '+a+" "+a+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+u+' shape-rendering="crispEdges">'+l+c+`</svg>
`;return typeof t=="function"&&t(null,f),f}});var qn=m(fe=>{"use strict";var Or=Pt(),st=An(),Pn=Mn(),Jr=Ln();function at(r,e,n,t,i){let o=[].slice.call(arguments,1),s=o.length,a=typeof o[s-1]=="function";if(!a&&!Or())throw new Error("Callback required as last argument");if(a){if(s<2)throw new Error("Too few arguments provided");s===2?(i=n,n=e,e=t=void 0):s===3&&(e.getContext&&typeof i>"u"?(i=t,t=void 0):(i=t,t=n,n=e,e=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(n=e,e=t=void 0):s===2&&!e.getContext&&(t=n,n=e,e=void 0),new Promise(function(l,c){try{let u=st.create(n,t);l(r(u,e,t))}catch(u){c(u)}})}try{let l=st.create(n,t);i(null,r(l,e,t))}catch(l){i(l)}}fe.create=st.create;fe.toCanvas=at.bind(null,Pn.render);fe.toDataURL=at.bind(null,Pn.renderToDataURL);fe.toString=at.bind(null,function(r,e,n){return Jr.render(r,n)})});var Mt=(()=>{let e=class e{constructor(t,i){this._http=t,this._core=i,this.ip="",this.currency="$",this.languages=re.languages?re.languages:[{code:"en",name:"English",origin:"English"}],this._http.get("/api/user/config",o=>{o.currency&&(this.currency=o.currency,this._core.emit("currency",this.currency)),o.ip&&(this.ip=o.ip,this._core.emit("ip",this.ip)),o.languages&&(this.languages=o.languages,this._core.emit("languages",this.languages))})}};e.\u0275fac=function(i){return new(i||e)(A(N),A(_e))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function Qn(r,e){if(r&1&&(w(0,"div")(1,"h3"),_(2,"Set domain settings"),y(),w(3,"table")(4,"thead")(5,"td"),_(6,"Type"),y(),w(7,"td"),_(8,"Host"),y(),w(9,"td"),_(10,"Value"),y()(),w(11,"tr")(12,"td"),_(13,"A Record"),y(),w(14,"td"),_(15,"*"),y(),w(16,"td"),_(17),y()(),w(18,"tr")(19,"td"),_(20,"A Record"),y(),w(21,"td"),_(22,"@"),y(),w(23,"td"),_(24),y()()()()),r&2){let n=M();b(17),H(n.config.ip),b(7),H(n.config.ip)}}var Rt=(()=>{let e=class e{constructor(t,i,o){this.config=t,this._alert=i,this._http=o,this.ip=re?.storeIp||""}update(){this._http.post("/api/store/domain",{_id:this.store._id,domain:this.domain},t=>{t.updated&&(this.store.domain=t.updated),t.text?this._alert.show({text:t.text}):this._alert.show({text:"Process failed"})})}};e.\u0275fac=function(i){return new(i||e)(C(Mt),C(Et),C(N))},e.\u0275cmp=B({type:e,selectors:[["app-store-domain"]],decls:8,vars:3,consts:[[4,"ngIf"],["label","Custom domain","placeholder","fill your domain",3,"wChange"],[3,"wClick","disabled"]],template:function(i,o){i&1&&(w(0,"h1"),_(1),y(),F(2,Qn,25,2,"div",0),w(3,"p"),_(4,"You can fill your own domain or write subdomain to our domain without any dots"),y(),w(5,"winput",1),P("wChange",function(a){return o.domain=a}),y(),w(6,"wbutton",2),P("wClick",function(){return o.update()}),_(7,"Update"),y()),i&2&&(b(),ne("Change domain: ",o.store.domain||"",""),b(),E("ngIf",o.config.ip),b(4),E("disabled",!o.domain))},dependencies:[ye,ve,Se]});let r=e;return r})();var kn=Yn(qn(),1);function Kr(r,e){if(r&1&&Ce(0,"canvas",1),r&2){let n=M();mt(n.styleClass),E("qrCode",n.value)("qrCodeErrorCorrectionLevel",n.errorCorrectionLevel)("qrCodeCenterImageSrc",n.centerImageSrc)("qrCodeCenterImageWidth",n.centerImageSize)("qrCodeCenterImageHeight",n.centerImageSize)("qrCodeMargin",n.margin)("width",n.size)("height",n.size)("ngStyle",n.style)("darkColor",n.darkColor)("lightColor",n.lightColor)}}var Fn=/^#(?:[0-9a-fA-F]{3,4}){1,2}$/,Yr=(()=>{let e=class e{constructor(t){this.viewContainerRef=t,this.errorCorrectionLevel=e.DEFAULT_ERROR_CORRECTION_LEVEL,this.darkColor="#000000FF",this.lightColor="#FFFFFFFF",this.margin=16}ngOnChanges(){return ct(this,null,function*(){if(!this.value)return;this.version&&this.version>40?(console.warn("[qrCode] max version is 40, clamping"),this.version=40):this.version&&this.version<1?(console.warn("[qrCode] min version is 1, clamping"),this.version=1):this.version!==void 0&&isNaN(this.version)&&(console.warn("[qrCode] version should be set to a number, defaulting to auto"),this.version=void 0);let t=this.viewContainerRef.element.nativeElement;if(!t)return;let i=t.getContext("2d");i&&i.clearRect(0,0,i.canvas.width,i.canvas.height);let o=this.errorCorrectionLevel??e.DEFAULT_ERROR_CORRECTION_LEVEL,s=Fn.test(this.darkColor)?this.darkColor:void 0,a=Fn.test(this.lightColor)?this.lightColor:void 0;Ct()&&(!s&&this.darkColor&&console.error("[ng-qrcode] darkColor set to invalid value, must be RGBA hex color string, eg: #3050A1FF"),!a&&this.lightColor&&console.error("[ng-qrcode] lightColor set to invalid value, must be RGBA hex color string, eg: #3050A130")),yield kn.default.toCanvas(t,this.value,{version:this.version,errorCorrectionLevel:o,width:this.width,margin:this.margin,color:{dark:s,light:a}});let l=this.centerImageSrc,c=Dn(this.centerImageWidth,e.DEFAULT_CENTER_IMAGE_SIZE),u=Dn(this.centerImageHeight,e.DEFAULT_CENTER_IMAGE_SIZE);if(l&&i){this.centerImage||(this.centerImage=new Image(c,u));let p=this.centerImage;l!==this.centerImage.src&&(p.src=l),c!==this.centerImage.width&&(p.width=c),u!==this.centerImage.height&&(p.height=u);let f=()=>{i.drawImage(p,t.width/2-c/2,t.height/2-u/2,c,u)};p.onload=f,p.complete&&f()}})}};e.DEFAULT_ERROR_CORRECTION_LEVEL="M",e.DEFAULT_CENTER_IMAGE_SIZE=40,e.\u0275fac=function(i){return new(i||e)(C(dt))},e.\u0275dir=ut({type:e,selectors:[["canvas","qrCode",""]],inputs:{value:[0,"qrCode","value"],version:[0,"qrCodeVersion","version"],errorCorrectionLevel:[0,"qrCodeErrorCorrectionLevel","errorCorrectionLevel"],width:"width",height:"height",darkColor:"darkColor",lightColor:"lightColor",centerImageSrc:[0,"qrCodeCenterImageSrc","centerImageSrc"],centerImageWidth:[0,"qrCodeCenterImageWidth","centerImageWidth"],centerImageHeight:[0,"qrCodeCenterImageHeight","centerImageHeight"],margin:[0,"qrCodeMargin","margin"]},features:[ht]});let r=e;return r})();function Dn(r,e){return r===void 0||r===""?e:typeof r=="string"?parseInt(r,10):r}var Un=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=B({type:e,selectors:[["qr-code"]],inputs:{value:"value",size:"size",style:"style",styleClass:"styleClass",darkColor:"darkColor",lightColor:"lightColor",errorCorrectionLevel:"errorCorrectionLevel",centerImageSrc:"centerImageSrc",centerImageSize:"centerImageSize",margin:"margin"},decls:1,vars:1,consts:[[3,"qrCode","qrCodeErrorCorrectionLevel","qrCodeCenterImageSrc","qrCodeCenterImageWidth","qrCodeCenterImageHeight","qrCodeMargin","width","height","class","ngStyle","darkColor","lightColor"],[3,"qrCode","qrCodeErrorCorrectionLevel","qrCodeCenterImageSrc","qrCodeCenterImageWidth","qrCodeCenterImageHeight","qrCodeMargin","width","height","ngStyle","darkColor","lightColor"]],template:function(i,o){i&1&&F(0,Kr,1,13,"canvas",0),i&2&&gt(o.value?0:-1)},dependencies:[wt,Yr],encapsulation:2});let r=e;return r})(),jn=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=me({type:e}),e.\u0275inj=de({imports:[yt]});let r=e;return r})();var Vn=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=B({type:e,selectors:[["app-store-qrcode"]],decls:1,vars:2,consts:[["size","1024","darkColor","#000","lightColor","#fff","errorCorrectionLevel","M","centerImageSize","200",1,"cutCanvas",3,"value","margin"]],template:function(i,o){i&1&&Ce(0,"qr-code",0),i&2&&E("value","https://"+o.store.domain)("margin",4)},dependencies:[Un]});let r=e;return r})();function Qr(r,e){if(r&1){let n=we();w(0,"wbutton",1),P("click",function(){ge(n);let i=M();return pe(i.changeAgent())}),_(1,"Change agent"),y()}}var zn=(()=>{let e=class e{get title(){return"Change ownership"+(this.us.role("admin")?" or agent":"")}constructor(t,i,o,s){this._translate=t,this._alert=i,this._http=o,this.us=s}changeOwnership(){this.userId?this._alert.question({unique:"storeownership",text:this._translate.translate("Store.Are you sure you want to transfer ownership?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._http.post("/api/store/change/ownership",{storeId:this.store._id,userId:this.userId},t=>{t?this._alert.show({text:this._translate.translate("Store.Ownership changed")}):this._alert.show({text:this._translate.translate("Store.There been a server error")})})}}]}):this._alert.error({text:this._translate.translate("Store.Please select user to transfer ownership")})}changeAgent(){this.userId?this._alert.question({unique:"storeagent",text:this._translate.translate("Store.Are you sure you want to transfer agent?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._http.post("/api/store/change/agent",{storeId:this.store._id,userId:this.userId},t=>{t?this._alert.show({text:this._translate.translate("Store.Agent changed")}):this._alert.show({text:this._translate.translate("Store.There been a server error")})})}}]}):this._alert.error({text:this._translate.translate("Store.Please select user to transfer agent")})}};e.\u0275fac=function(i){return new(i||e)(C(Ee),C(D),C(N),C(Ie))},e.\u0275cmp=B({type:e,selectors:[["app-store-transfer"]],decls:6,vars:4,consts:[["placeholder","Select new user","searchableBy","name email","name","email",3,"modelChange","searchable","items"],[3,"click"],[3,"click",4,"ngIf"]],template:function(i,o){i&1&&(w(0,"h1"),_(1),y(),w(2,"wselect",0),P("modelChange",function(a){return o.userId=a}),y(),w(3,"wbutton",1),P("click",function(){return o.changeOwnership()}),_(4,"Change ownership"),y(),F(5,Qr,2,0,"wbutton",2)),i&2&&(b(),H(o.title),b(),E("searchable",!0)("items",o.us.users),b(3),E("ngIf",o.us.role("admin")))},dependencies:[St,ye,ve]});let r=e;return r})();var Hn=(()=>{let e=class e{plan(t){return this._planfeatures.plan?this._planfeatures.plan[t]||[]:[]}new(){return{}}constructor(t,i){this.mongo=t,this.alert=i,this.planfeatures=[],this._planfeatures={},this.planfeatures=t.get("userfeature",{replace:{inPlan:t.beObj,inDone:t.beObj},sort:t.sortAscNumber("order")},(o,s)=>{this._planfeatures=s})}create(t=this.new(),i=s=>{},o="planfeature has been created."){t._id?this.save(t):this.mongo.create("userfeature",t,s=>{i(s),this.alert.show({text:o})})}doc(t){return this._planfeatures[t]||(this._planfeatures[t]=this.mongo.fetch("userfeature",{query:{_id:t}})),this._planfeatures[t]}update(t,i=s=>{},o="planfeature has been updated."){this.mongo.afterWhile(t,()=>{this.save(t,i,o)})}save(t,i=s=>{},o="planfeature has been updated."){this.mongo.update("userfeature",t,()=>{o&&this.alert.show({text:o,unique:t})})}delete(t,i=s=>{},o="planfeature has been deleted."){this.mongo.delete("userfeature",t,()=>{o&&this.alert.show({text:o})})}};e.\u0275fac=function(i){return new(i||e)(A($),A(D))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var On=(()=>{let e=class e{new(){return{}}constructor(t,i,o){this.mongo=t,this.alert=i,this._http=o,this.themeJsons=[],this.byModule={},this.themes=[],this._themes={},this._http.get("/api/theme/jsons",s=>s.forEach(a=>this.themeJsons.push(a))),this.themes=t.get("theme",{groups:"module"},(s,a)=>{this.byModule=a.module,this._themes=a})}create(t=this.new(),i=s=>{},o="theme has been created."){t._id?this.save(t):this.mongo.create("theme",t,s=>{i(s),this.alert.show({text:o})})}doc(t){return this._themes[t]||(this._themes[t]=this.mongo.fetch("theme",{query:{_id:t}})),this._themes[t]}update(t,i=s=>{},o="theme has been updated."){this.mongo.afterWhile(t,()=>{this.save(t,i,o)})}save(t,i=s=>{},o="theme has been updated."){this.mongo.update("theme",t,()=>{o&&this.alert.show({text:o,unique:t})})}delete(t,i=s=>{},o="theme has been deleted."){this.mongo.delete("theme",t,()=>{o&&this.alert.show({text:o})})}};e.\u0275fac=function(i){return new(i||e)(A($),A(D),A(N))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function ei(r,e){if(r&1){let n=we();w(0,"winput",5),P("wChange",function(i){let o=ge(n).$implicit,s=M();return o.enabled=i,pe(s.update(o))}),y()}if(r&2){let n=e.$implicit;E("value",n.enabled)}}function ti(r,e){if(r&1&&_(0),r&2){let n=e.$implicit,t=M();ne(" ",t.us.doc(n.author).email," ")}}function ni(r,e){if(r&1&&_(0),r&2){let n=e.$implicit,t=M();ne(" ",n.agent?t.us.doc(n.agent).email:""," ")}}function ri(r,e){if(r&1&&(w(0,"a",6),_(1),y()),r&2){let n=e.$implicit;pt("href","https://",n.domain,"",ft),b(),H(n.domain)}}var Jn=(()=>{let e=class e{setVariables(t={}){if(t.theme&&this.fetchedTheme!==t.theme){this.variables.splice(0,this.variables.length),this.features.splice(0,this.features.length),this.fetchedTheme=t.theme,this._http.get(`/api/theme/template/variables/${t.theme}`,o=>{let s=!0;t.variables=t.variables||{};for(let a in o.variables){let l=o.variablesInfo[a]?.name||"Text";this.variables.push({focused:!!(s&&l==="Text"),key:a,root:!0,name:l,fields:[{name:"Placeholder",value:"fill "+a},{name:"Label",value:a}]}),l==="Text"&&(s=!1),t.variables[a]=typeof t.variables[a]>"u"?o.variables[a]:t.variables[a]}}),this.features.splice(0,this.features.length);let i=this._ts.doc(t.theme);for(let o of i.features||[])this.features.push(this._ufs.doc(o))}}get rows(){return this._ss.stores}update(t){this._ss.update(t)}constructor(t,i,o,s,a,l,c,u,p,f,v,x){this._translate=t,this._ufs=i,this._alert=o,this._mongo=s,this._modal=a,this._http=l,this._form=c,this._core=u,this._ts=p,this._ss=f,this._tss=v,this.us=x,this.title=this._ss.config.pageTitle,this.columns=["enabled","name","domain"],this.features=[],this.variables=[],this.formVariables=this._form.getForm("variables",{formId:"variables",title:"Variables",components:this.variables}),this.config={create:()=>{this._form.modal(this.form,{label:this._translate.translate("Common.Create"),click:(h,S)=>{this._ss.create(h),S()}},this._ss.config.defaultIndexPage?{indexPage:this._ss.config.defaultIndexPage}:{}).then(this._ss.create.bind(this))},update:h=>{this._form.modal(this.form,[],h).then(S=>{S&&(this._core.copy(S,h),this._ss.save(h)),this.setVariables(h)})},delete:h=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this store?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._ss.delete(h)}}]})},buttons:[{icon:"text_fields",click:h=>{h.variables=h.variables||{},this._form.modal(this.formVariables,[],h.variables).then(S=>{this._core.copy(S,h.variables),this._ss.save(h)})}},{icon:"cloud_download",click:h=>{this._modal.show({component:Rt,store:h})}},{icon:"qr_code",click:h=>{this._modal.show({component:Vn,store:h})}},this.us.role("agent")||this.us.role("admin")?{icon:"people",click:h=>{this._modal.show({component:zn,store:h})}}:null]},this.us.role("admin")?(this.columns.push("author"),this.columns.push("agent")):this.us.role("agent")&&(this.columns.push("location"),this.columns.push("author")),this._mongo.on("store theme",()=>{for(let h of this.rows)this.setVariables(h)}),this._mongo.on("theme tag",()=>{let h=this._ss.config.pages.map(S=>({_id:S.page,name:S.page}));this.form=this._form.getForm("store",{formId:"store",title:this._ss.config.docTitle,components:[{name:"Photo",key:"favicon",fields:[{name:"Label",value:"Favicon"},{name:"Width",value:64},{name:"Height",value:64}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill your name"},{name:"Label",value:"Name"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill your description"},{name:"Label",value:"Description"}]},{name:"Select",key:"features",fields:[{name:"Placeholder",value:"Select features"},{name:"Items",value:this.features},{name:"Multiple",value:!0}]},{name:"Select",key:"theme",fields:[{name:"Placeholder",value:"Select theme"},{name:"Items",value:this._ts.byModule.store}]},{name:"Text",key:"currency",fields:[{name:"Placeholder",value:"fill custom currency"},{name:"Label",value:"Currency"}]}]})})}};e.\u0275fac=function(i){return new(i||e)(C(Ee),C(Hn),C(D),C($),C(It),C(N),C(vt),C(_e),C(On),C(At),C(Bt),C(Ie))},e.\u0275cmp=B({type:e,selectors:[["ng-component"]],decls:5,vars:4,consts:[[3,"columns","config","title","rows"],["cell","enabled"],["cell","author"],["cell","agent"],["cell","domain"],["type","checkbox",3,"wChange","value"],["target","_blank",3,"href"]],template:function(i,o){i&1&&(w(0,"wtable",0),F(1,ei,1,1,"ng-template",1)(2,ti,1,1,"ng-template",2)(3,ni,1,1,"ng-template",3)(4,ri,2,3,"ng-template",4),y()),i&2&&E("columns",o.columns)("config",o.config)("title",o.title)("rows",o.rows)},dependencies:[Se,Tt,bt]});let r=e;return r})();var ii=[{path:"",component:Jn}],go=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=me({type:e}),e.\u0275inj=de({imports:[_t.forChild(ii),jn,xt]});let r=e;return r})();export{go as StoresModule};
