import{a as Q}from"./chunk-NN7DSGKL.js";import{g as K}from"./chunk-ABGPTASO.js";import"./chunk-2YKZWEXU.js";import{D as a,E as m,H as h,J as p,Ka as A,O as s,P as l,R as M,Ra as L,S as F,T as I,U as w,Ua as B,V as u,Wa as R,Ya as f,_a as g,ca as c,db as W,ea as d,fa as P,ja as $,ka as O,l as b,la as k,lb as z,m as T,ma as D,mb as G,n as x,o as j,p as E,pb as H,qb as J,t as S,ta as V,u as y,ua as N,wa as q}from"./chunk-HR67YQAP.js";var X=(()=>{class t{new(){return{}}constructor(e,i){this.mongo=e,this.alert=i,this.orders=[],this._orders={},this.orders=e.get("order",{name:"admin"},(r,o)=>{this._orders=o})}create(e=this.new(),i=o=>{},r="order has been created."){e._id?this.save(e):this.mongo.create("order",e,o=>{i(o),this.alert.show({text:r})})}doc(e){return this._orders[e]||(this._orders[e]=this.mongo.fetch("order",{query:{_id:e}})),this._orders[e]}update(e,i=o=>{},r="order has been updated."){this.mongo.afterWhile(e,()=>{this.save(e,i,r)})}save(e,i=o=>{},r="order has been updated."){this.mongo.update("order",e,{name:"admin"},()=>{r&&this.alert.show({text:r,unique:e})})}delete(e,i=o=>{},r="order has been deleted."){this.mongo.delete("order",e,()=>{r&&this.alert.show({text:r})})}static{this.\u0275fac=function(i){return new(i||t)(x(f),x(g))}}static{this.\u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ne=()=>["new","ordered","preparing","sent","completed"];function oe(t,n){if(t&1){let e=I();s(0,"wselect",7),w("modelChange",function(r){S(e);let o=u();return y(o.setStore(r))}),l()}if(t&2){let e=u();p("clearable",!0)("items",e.stores)("select",e.store)}}function se(t,n){if(t&1&&(c(0),O(1,"mongodate"),O(2,"date")),t&2){let e=n.$implicit;d(" ",D(2,3,k(1,1,e._id),"M/d/yy, h:mm a")," ")}}function le(t,n){if(t&1&&(s(0,"div"),c(1),l()),t&2){let e=n.$implicit;a(),P(" ",e.product.name," ",e.product.price," x ",e.quantity," \u0448\u0442 ")}}function ae(t,n){if(t&1&&h(0,le,2,3,"div",8),t&2){let e=n.$implicit;p("ngForOf",e.products)}}function ce(t,n){if(t&1){let e=I();s(0,"wselect",9),w("modelChange",function(r){let o=S(e).$implicit,v=u();return y(v.setStatus(o,r))}),l()}if(t&2){let e=n.$implicit;p("select",e.status)("items",$(2,ne))}}function me(t,n){if(t&1&&(M(0),s(1,"div"),c(2),l(),s(3,"div"),c(4),l(),s(5,"div"),c(6),l(),s(7,"div"),c(8),l(),s(9,"div"),c(10),l(),F()),t&2){let e=u().$implicit;a(2),d("Email: ",e.delivery.email,""),a(2),d("Name: ",e.delivery.name,""),a(2),d("City: ",e.delivery.city,""),a(2),d("Address: ",e.delivery.address,""),a(2),d("Phone: ",e.delivery.phone,"")}}function de(t,n){if(t&1&&h(0,me,11,5,"ng-container",10),t&2){let e=n.$implicit;p("ngIf",e.delivery)}}function pe(t,n){if(t&1&&(s(0,"div"),c(1),l()),t&2){let e=u().$implicit;a(),d("Discount: -",e==null?null:e.discount.amount,"%")}}function ue(t,n){if(t&1&&(h(0,pe,2,1,"div",10),s(1,"div"),c(2),l()),t&2){let e=n.$implicit,i=u();p("ngIf",e==null?null:e.discount),a(2),d("Total: ",i.getProductsTotal(e)-i.getProductsTotal(e)*((e==null||e.discount==null?null:e.discount.amount)||0)/100," \u0433\u0440\u043D")}}var Y=(()=>{class t{setOrders(){this.orders.splice(0,this.orders.length);for(let e of this._os.orders)e.stores=e.stores||[],this.store?e.stores.includes(this.store)&&this.orders.push(e):this.orders.push(e)}setStatus(e,i){e.status=i,this.update(e)}update(e){this._os.update(e)}get stores(){return this._ss.stores}setStore(e){this.store=e,this._store.set("store",e),this.setOrders()}constructor(e,i,r,o,v,Z,ee,te){this._os=e,this._translate=i,this._alert=r,this._form=o,this._core=v,this._store=Z,this._ss=ee,this._mongo=te,this.columns=["date","products","information","price","status"],this.form=this._form.getForm("orders",{formId:"orders",title:"Orders",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill orders title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill orders description"},{name:"Label",value:"Description"}]},{name:"Select",key:"stores",fields:[{name:"Placeholder",value:"fill your stores"},{name:"Label",value:"Stores"},{name:"Multiple",value:!0},{name:"Items",value:this.stores}]}]}),this.config={create:()=>{this._form.modal(this.form,{label:"Create",click:(_,C)=>{this._os.create(_,this.setOrders.bind(this)),C()}},this.store?{stores:[this.store]}:{})},update:_=>{this._form.modal(this.form,[],_).then(C=>{this._core.copy(C,_),this._os.save(_)})}},this.orders=[],this._store.get("store",this.setStore.bind(this)),this._mongo.on("order",this.setOrders.bind(this))}getProductsTotal(e){return e.products.reduce((i,r)=>i+r.product.price,0)}static{this.\u0275fac=function(i){return new(i||t)(m(X),m(W),m(g),m(z),m(L),m(R),m(Q),m(f))}}static{this.\u0275cmp=j({type:t,selectors:[["ng-component"]],decls:7,vars:4,consts:[["placeholder","Select store","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],["title","Orders",3,"columns","config","rows"],["cell","date"],["cell","products"],["cell","status"],["cell","information"],["cell","price"],["placeholder","Select store",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],[4,"ngFor","ngForOf"],[3,"modelChange","select","items"],[4,"ngIf"]],template:function(i,r){i&1&&(h(0,oe,1,3,"wselect",0),s(1,"wtable",1),h(2,se,3,6,"ng-template",2)(3,ae,1,1,"ng-template",3)(4,ce,1,3,"ng-template",4)(5,de,1,1,"ng-template",5)(6,ue,3,2,"ng-template",6),l()),i&2&&(p("ngIf",r.stores.length),a(),p("columns",r.columns)("config",r.config)("rows",r._os.orders))},dependencies:[G,V,N,J,H,q,B]})}}return t})();var he=[{path:"",component:Y}],be=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=E({type:t})}static{this.\u0275inj=T({imports:[A.forChild(he),K]})}}return t})();export{be as OrdersModule};
