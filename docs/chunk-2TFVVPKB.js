import{a as et}from"./chunk-LVMI42ZP.js";import{a as R}from"./chunk-DZVV4JSR.js";import{a as tt}from"./chunk-YE5FV3IB.js";import{g as Z}from"./chunk-C3S2QHG2.js";import"./chunk-TGKOXAGH.js";import{A as L,C as f,D as n,Ga as B,H as y,J as p,Ka as G,O as l,P as m,Q as $,Ra as H,T as C,U as d,V as u,Wa as J,Xa as U,Ya as x,_a as S,a as V,b as N,ca as _,da as O,db as z,ea as q,eb as k,gb as T,jb as W,l as M,lb as Y,m as D,mb as K,n as I,o as b,p as F,pb as Q,qb as X,t as g,u as v,ua as A}from"./chunk-2AZ5U4IF.js";var w=(()=>{let r=class r{new(){return{}}constructor(t,e){this.mongo=t,this.alert=e,this.products=[],this.byTag={},this._products={},this.products=t.get("product",{groups:"tag",query:{isTemplate:i=>i.isTemplate,isNotTemplate:i=>!i.isTemplate}},(i,c)=>{this._products=c,this.byTag=c.tag})}create(t=this.new(),e=c=>{},i="product has been created."){t._id?this.save(t):this.mongo.create("product",t,c=>{typeof e=="function"&&e(c),i&&this.alert.show({text:i})})}doc(t){return this._products[t]||(this._products[t]=this.mongo.fetch("product",{query:{_id:t}})),this._products[t]}update(t,e=()=>{},i="product has been updated."){this.mongo.afterWhile(t,()=>{this.save(t,e,i)})}save(t,e=()=>{},i="product has been updated."){this.mongo.update("product",t,()=>{typeof e=="function"&&e(),i&&this.alert.show({text:i,unique:t})})}delete(t,e=()=>{},i="product has been deleted."){this.mongo.delete("product",t,()=>{typeof e=="function"&&e(),i&&this.alert.show({text:i})})}};r.\u0275fac=function(e){return new(e||r)(I(x),I(S))},r.\u0275prov=M({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var it=(()=>{let r=class r{constructor(t){this._ps=t,this.chatGPT="[{name: 'Entity Name'}]",this.entities=""}create(){let t=JSON.parse(this.entities);for(let e of t)e.tags=this.tag?[this.tag]:[],this._ps.create(e)}};r.\u0275fac=function(e){return new(e||r)(n(w))},r.\u0275cmp=b({type:r,selectors:[["app-products-create"]],decls:9,vars:1,consts:[["placeholder","Provide array of Products",3,"wChange"],[3,"click"]],template:function(e,i){e&1&&(l(0,"h1"),_(1,"Create Products"),m(),l(2,"winput",0),d("wChange",function(P){return i.entities=P}),m(),l(3,"wbutton",1),d("click",function(){return i.create(),i.close()}),_(4,"Create"),m(),l(5,"div"),_(6,"Drop next text to chatGPT to inform him what data he should create. After that you can inform him what you need to be created"),m(),l(7,"pre"),_(8),m()),e&2&&(f(8),O(i.chatGPT))},dependencies:[k,T]});let s=r;return s})();function ft(s,r){if(s&1){let o=C();l(0,"wselect",7),d("modelChange",function(e){g(o);let i=u();return v(i.setStore(e))}),m()}if(s&2){let o=u();p("clearable",!0)("items",o.stores)("select",o.store)}}function _t(s,r){if(s&1){let o=C();l(0,"wselect",8),d("modelChange",function(e){g(o);let i=u();return v(i.setTag(e))}),m()}if(s&2){let o=u();p("clearable",!0)("items",o.tags)("select",o.tag)}}function gt(s,r){if(s&1&&(l(0,"div"),_(1),m()),s&2){let o=u();f(),q("Products would be shown also on ",o.available,"")}}function vt(s,r){if(s&1){let o=C();l(0,"winput",9),d("wChange",function(e){let i=g(o).$implicit,c=u();return i.enabled=e,v(c.update(i))}),m()}if(s&2){let o=r.$implicit;p("value",o.enabled)}}function Ct(s,r){if(s&1){let o=C();l(0,"winput",9),d("wChange",function(e){let i=g(o).$implicit,c=u();return i.top=e,v(c.update(i))}),m()}if(s&2){let o=r.$implicit;p("value",o.top)}}function wt(s,r){if(s&1&&$(0,"img",11),s&2){let o=u().$implicit;p("src",o.thumb,L)("alt",o.name)}}function bt(s,r){if(s&1&&y(0,wt,1,2,"img",10),s&2){let o=r.$implicit;p("ngIf",o.thumb)}}var rt=(()=>{let r=class r{setProducts(){this.products.splice(0,this.products.length);for(let t of this._ps.products)t.tags=t.tags||[],this.tag?t.tags.includes(this.tag)&&this.products.push(t):this.products.push(t)}get title(){return this._router.url==="/craftsman/crafts"?"Crafts":this._router.url==="/craftsman/craftlinks"?"Product Links":"Products"}update(t){this._ps.update(t)}tagIncludeStore(t){if(t.stores.includes(this.store))return!0;for(;t.parent;)if(t=this._ts.doc(t.parent),t.stores.includes(this.store))return!0;return!1}setTags(){this.tags.splice(0,this.tags.length);for(let t of this._ts.tags)t.stores=t.stores||[],(!this.store||this.tagIncludeStore(t))&&this.tags.push(N(V({},t),{name:this.tagName(t)}));this.tags.sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0),this.setProducts()}setTag(t){if(this._store.set("tag",t),this.tag=t,this.available="",t){let e=this._ts.doc(t);for(;e.parent;)e=this._ts.doc(e.parent),this.available+=(this.available?", ":"")+e.name}this.setProducts()}tagName(t){let e=t.name;for(;t.parent;)t=this._ts.doc(t.parent),e=t.name+" / "+e;return e}get stores(){return this._ss.stores}setStore(t){this.store=t,this._store.set("store",t),this.setTags()}constructor(t,e,i,c,P,st,ot,nt,at,ct,lt,mt,pt){this._translate=t,this._modal=e,this._alert=i,this._mongo=c,this._store=P,this._ps=st,this._form=ot,this._core=nt,this._http=at,this._ss=ct,this._us=lt,this._ts=mt,this._router=pt,this.columns=["enabled","top","thumb","name","price"],this.tags=[],this.form=this._form.getForm("product",{formId:"product",title:"Product",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill product title"},{name:"Label",value:"Title"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Photos",key:"thumbs",fields:[{name:"Label",value:"Detailed pictures"}]},{name:"Text",key:"short",fields:[{name:"Placeholder",value:"fill product short description"},{name:"Label",value:"Short Description"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill product description"},{name:"Label",value:"Description"}]},{name:"Number",key:"price",fields:[{name:"Placeholder",value:"fill product price"},{name:"Label",value:"Price"}]},{name:"Select",key:"tags",fields:[{name:"Placeholder",value:"fill product tag"},{name:"Label",value:"Tag"},{name:"Multiple",value:!0},{name:"Items",value:this.tags}]}]}),this.config={create:this._router.url==="/craftsman/craftlinks"?null:()=>{this._form.modal(this.form,{label:"Create",click:(a,h)=>{a.isTemplate=this._router.url==="/craftsman/crafts",this._ps.create(a,this.setProducts.bind(this)),h()}},this.tag?{tags:[this.tag]}:{})},update:this._router.url==="/craftsman/craftlinks"?null:a=>{this._form.modal(this.form,[],a).then(h=>{this._core.copy(h,a),this._ps.save(a)})},delete:this._router.url==="/craftsman/craftlinks"?null:a=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this product?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._ps.delete(a,this.setProducts.bind(this))}}]})},buttons:this._router.url==="/craftsman/craftlinks"?null:[{icon:"cloud_download",click:a=>{this._form.modalUnique("product","url",a)}}],headerButtons:[this._us.role("admin")||this._us.role("agent")?{icon:"add_circle",click:()=>{this._modal.show({component:it,tag:this.tag})}}:null]},this.products=[],this._store.get("store",this.setStore.bind(this)),this._store.get("tag",this.setTag.bind(this)),this._mongo.on("tag",this.setTags.bind(this)),this._mongo.on("product",this.setProducts.bind(this)),this._router.url==="/craftsman/craftlinks"?this._http.get("/api/product/getlinks",a=>{a.forEach(h=>this.products.push(h))}):this._router.url==="/admin/products"&&this._http.get("/api/product/getadmin",a=>{a.forEach(h=>this.products.push(h))})}};r.\u0275fac=function(e){return new(e||r)(n(z),n(W),n(S),n(x),n(J),n(w),n(Y),n(H),n(U),n(tt),n(R),n(et),n(B))},r.\u0275cmp=b({type:r,selectors:[["ng-component"]],decls:7,vars:7,consts:[["placeholder","Select store","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],["placeholder","Select tag","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],[4,"ngIf"],[3,"title","columns","config","rows"],["cell","enabled"],["cell","top"],["cell","thumb"],["placeholder","Select store",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["placeholder","Select tag",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["type","checkbox",3,"wChange","value"],["style","height: 50px;",3,"src","alt",4,"ngIf"],[2,"height","50px",3,"src","alt"]],template:function(e,i){e&1&&(y(0,ft,1,3,"wselect",0)(1,_t,1,3,"wselect",1)(2,gt,2,1,"div",2),l(3,"wtable",3),y(4,vt,1,1,"ng-template",4)(5,Ct,1,1,"ng-template",5)(6,bt,1,1,"ng-template",6),m()),e&2&&(p("ngIf",i.stores.length),f(),p("ngIf",i.tags.length),f(),p("ngIf",i.available),f(),p("title",i.title)("columns",i.columns)("config",i.config)("rows",i.products))},dependencies:[K,A,T,X,Q]});let s=r;return s})();var yt=[{path:"",component:rt}],Rt=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=F({type:r}),r.\u0275inj=D({imports:[G.forChild(yt),Z]});let s=r;return s})();export{Rt as ProductsModule};
