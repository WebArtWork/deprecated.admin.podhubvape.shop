import{Ga as d,La as a,Ra as c,Va as l,Wa as u,Xa as m,_a as p,db as f,l as h,n as i}from"./chunk-KNFC6JSA.js";var P=(()=>{class r extends l{constructor(e,t,s,o,g,w){super({name:"user"},e,t,s,o),this._router=g,this._translate=w,this.roles=a.roles||["admin"],this.roleName=a.roleName||{admin:"Admin"},this.roleDescription=a.roleDescription||{admin:"Administrator of the project"},this.mode="",this.users=[],this.user=localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new(),this._changingPassword=!1,this.store=t,this.http=e,this.alert=s,this.core=o,this.http.header("token")&&(this.fetch({},{name:"me"}).subscribe(this.setUser.bind(this)),this.load()),this.store.get("mode",n=>{n&&this.setMode(n)})}load(){this.get().subscribe(e=>this.users.push(...e))}setMode(e=""){e?(this.store.set("mode",e),document.body.parentNode.classList.add(e)):(this.store.remove("mode"),document.body.parentNode.classList.remove("dark")),this.mode=e}setUser(e){this.user=e,localStorage.setItem("waw_user",JSON.stringify(e)),this.core.complete("us.user")}role(e){return!!(this.user?.is||{})[e]}updateMe(){this.setUser(this.user),this.update(this.user)}updateMeAfterWhile(){this.setUser(this.user),this.updateAfterWhile(this.user)}changePassword(e,t){this._changingPassword||(this._changingPassword=!0,this.http.post("/api/user/changePassword",{newPass:t,oldPass:e},s=>{this._changingPassword=!1,s?this.alert.info({text:"Successfully changed password"}):this.alert.error({text:"Incorrect current password"})}))}logout(){this.user=this.new(),localStorage.removeItem("waw_user"),this._router.navigateByUrl("/sign"),this.http.remove("token"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}addRole(e,t=()=>{}){this.http.post("api/user/role",e).subscribe(s=>{t(),s.created?this.alert.show({text:this._translate.translate("User.User has been created and assigned")}):s.assigned&&this.alert.show({text:this._translate.translate("User.User has been assigned")})})}static{this.\u0275fac=function(t){return new(t||r)(i(m),i(u),i(p),i(c),i(d),i(f))}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{P as a};
