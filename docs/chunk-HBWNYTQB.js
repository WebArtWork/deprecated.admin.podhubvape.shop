import{a as tt}from"./chunk-L7CIC3PC.js";import{a as Z}from"./chunk-JBVE7GSA.js";import{a as R}from"./chunk-CLYS6LLK.js";import{g as X}from"./chunk-G5ZQNHKW.js";import"./chunk-UXV34W4T.js";import{B as F,D as f,E as s,Ga as A,H as P,J as l,Ka as B,O as a,P as c,Q as L,Ra as G,T as C,U as u,V as p,Wa as H,Xa as J,Ya as y,_a as x,a as E,b as M,ca as _,da as $,db as U,ea as O,eb as I,gb as T,jb as z,l as V,lb as W,m as N,mb as Y,n as S,o as b,p as D,pb as K,qb as Q,t as g,u as v,ua as q}from"./chunk-KNFC6JSA.js";var w=(()=>{class i{new(){return{}}constructor(t,e){this.mongo=t,this.alert=e,this.products=[],this.byTag={},this._products={},this.products=t.get("product",{groups:"tag",query:{isTemplate:r=>r.isTemplate,isNotTemplate:r=>!r.isTemplate}},(r,o)=>{this._products=o,this.byTag=o.tag})}create(t=this.new(),e=o=>{},r="product has been created."){t._id?this.save(t):this.mongo.create("product",t,o=>{typeof e=="function"&&e(o),r&&this.alert.show({text:r})})}doc(t){return this._products[t]||(this._products[t]=this.mongo.fetch("product",{query:{_id:t}})),this._products[t]}update(t,e=()=>{},r="product has been updated."){this.mongo.afterWhile(t,()=>{this.save(t,e,r)})}save(t,e=()=>{},r="product has been updated."){this.mongo.update("product",t,()=>{typeof e=="function"&&e(),r&&this.alert.show({text:r,unique:t})})}delete(t,e=()=>{},r="product has been deleted."){this.mongo.delete("product",t,()=>{typeof e=="function"&&e(),r&&this.alert.show({text:r})})}static{this.\u0275fac=function(e){return new(e||i)(S(y),S(x))}}static{this.\u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var et=(()=>{class i{constructor(t){this._ps=t,this.chatGPT="[{name: 'Entity Name'}]",this.entities=""}create(){let t=JSON.parse(this.entities);for(let e of t)e.tags=this.tag?[this.tag]:[],this._ps.create(e)}static{this.\u0275fac=function(e){return new(e||i)(s(w))}}static{this.\u0275cmp=b({type:i,selectors:[["app-products-create"]],decls:9,vars:1,consts:[["placeholder","Provide array of Products",3,"wChange"],[3,"click"]],template:function(e,r){e&1&&(a(0,"h1"),_(1,"Create Products"),c(),a(2,"winput",0),u("wChange",function(d){return r.entities=d}),c(),a(3,"wbutton",1),u("click",function(){return r.create(),r.close()}),_(4,"Create"),c(),a(5,"div"),_(6,"Drop next text to chatGPT to inform him what data he should create. After that you can inform him what you need to be created"),c(),a(7,"pre"),_(8),c()),e&2&&(f(8),$(r.chatGPT))},dependencies:[I,T]})}}return i})();function ht(i,m){if(i&1){let t=C();a(0,"wselect",7),u("modelChange",function(r){g(t);let o=p();return v(o.setStore(r))}),c()}if(i&2){let t=p();l("clearable",!0)("items",t.stores)("select",t.store)}}function ft(i,m){if(i&1){let t=C();a(0,"wselect",8),u("modelChange",function(r){g(t);let o=p();return v(o.setTag(r))}),c()}if(i&2){let t=p();l("clearable",!0)("items",t.tags)("select",t.tag)}}function _t(i,m){if(i&1&&(a(0,"div"),_(1),c()),i&2){let t=p();f(),O("Products would be shown also on ",t.available,"")}}function gt(i,m){if(i&1){let t=C();a(0,"winput",9),u("wChange",function(r){let o=g(t).$implicit,d=p();return o.enabled=r,v(d.update(o))}),c()}if(i&2){let t=m.$implicit;l("value",t.enabled)}}function vt(i,m){if(i&1){let t=C();a(0,"winput",9),u("wChange",function(r){let o=g(t).$implicit,d=p();return o.top=r,v(d.update(o))}),c()}if(i&2){let t=m.$implicit;l("value",t.top)}}function Ct(i,m){if(i&1&&L(0,"img",11),i&2){let t=p().$implicit;l("src",t.thumb,F)("alt",t.name)}}function wt(i,m){if(i&1&&P(0,Ct,1,2,"img",10),i&2){let t=m.$implicit;l("ngIf",t.thumb)}}var it=(()=>{class i{setProducts(){this.products.splice(0,this.products.length);for(let t of this._ps.products)t.tags=t.tags||[],this.tag?t.tags.includes(this.tag)&&this.products.push(t):this.products.push(t)}get title(){return this._router.url==="/craftsman/crafts"?"Crafts":this._router.url==="/craftsman/craftlinks"?"Product Links":"Products"}update(t){this._ps.update(t)}tagIncludeStore(t){if(t.stores.includes(this.store))return!0;for(;t.parent;)if(t=this._ts.doc(t.parent),t.stores.includes(this.store))return!0;return!1}setTags(){this.tags.splice(0,this.tags.length);for(let t of this._ts.tags)t.stores=t.stores||[],(!this.store||this.tagIncludeStore(t))&&this.tags.push(M(E({},t),{name:this.tagName(t)}));this.tags.sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0),this.setProducts()}setTag(t){if(this._store.set("tag",t),this.tag=t,this.available="",t){let e=this._ts.doc(t);for(;e.parent;)e=this._ts.doc(e.parent),this.available+=(this.available?", ":"")+e.name}this.setProducts()}tagName(t){let e=t.name;for(;t.parent;)t=this._ts.doc(t.parent),e=t.name+" / "+e;return e}get stores(){return this._ss.stores}setStore(t){this.store=t,this._store.set("store",t),this.setTags()}constructor(t,e,r,o,d,rt,ot,st,nt,at,ct,lt,mt){this._translate=t,this._modal=e,this._alert=r,this._mongo=o,this._store=d,this._ps=rt,this._form=ot,this._core=st,this._http=nt,this._ss=at,this._us=ct,this._ts=lt,this._router=mt,this.columns=["enabled","top","thumb","name","price"],this.tags=[],this.form=this._form.getForm("product",{formId:"product",title:"Product",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill product title"},{name:"Label",value:"Title"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Photos",key:"thumbs",fields:[{name:"Label",value:"Detailed pictures"}]},{name:"Text",key:"short",fields:[{name:"Placeholder",value:"fill product short description"},{name:"Label",value:"Short Description"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill product description"},{name:"Label",value:"Description"}]},{name:"Number",key:"price",fields:[{name:"Placeholder",value:"fill product price"},{name:"Label",value:"Price"}]},{name:"Select",key:"tags",fields:[{name:"Placeholder",value:"fill product tag"},{name:"Label",value:"Tag"},{name:"Multiple",value:!0},{name:"Items",value:this.tags}]}]}),this.config={create:this._router.url==="/craftsman/craftlinks"?null:()=>{this._form.modal(this.form,{label:"Create",click:(n,h)=>{n.isTemplate=this._router.url==="/craftsman/crafts",this._ps.create(n,this.setProducts.bind(this)),h()}},this.tag?{tags:[this.tag]}:{})},update:this._router.url==="/craftsman/craftlinks"?null:n=>{this._form.modal(this.form,[],n).then(h=>{this._core.copy(h,n),this._ps.save(n)})},delete:this._router.url==="/craftsman/craftlinks"?null:n=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this product?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._ps.delete(n,this.setProducts.bind(this))}}]})},buttons:this._router.url==="/craftsman/craftlinks"?null:[{icon:"cloud_download",click:n=>{this._form.modalUnique("product","url",n)}}],headerButtons:[this._us.role("admin")||this._us.role("agent")?{icon:"add_circle",click:()=>{this._modal.show({component:et,tag:this.tag})}}:null]},this.products=[],this._store.get("store",this.setStore.bind(this)),this._store.get("tag",this.setTag.bind(this)),this._mongo.on("tag",this.setTags.bind(this)),this._mongo.on("product",this.setProducts.bind(this)),this._router.url==="/craftsman/craftlinks"?this._http.get("/api/product/getlinks",n=>{n.forEach(h=>this.products.push(h))}):this._router.url==="/admin/products"&&this._http.get("/api/product/getadmin",n=>{n.forEach(h=>this.products.push(h))})}static{this.\u0275fac=function(e){return new(e||i)(s(U),s(z),s(x),s(y),s(H),s(w),s(W),s(G),s(J),s(Z),s(R),s(tt),s(A))}}static{this.\u0275cmp=b({type:i,selectors:[["ng-component"]],decls:7,vars:7,consts:[["placeholder","Select store","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],["placeholder","Select tag","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],[4,"ngIf"],[3,"title","columns","config","rows"],["cell","enabled"],["cell","top"],["cell","thumb"],["placeholder","Select store",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["placeholder","Select tag",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["type","checkbox",3,"wChange","value"],["style","height: 50px;",3,"src","alt",4,"ngIf"],[2,"height","50px",3,"src","alt"]],template:function(e,r){e&1&&(P(0,ht,1,3,"wselect",0)(1,ft,1,3,"wselect",1)(2,_t,2,1,"div",2),a(3,"wtable",3),P(4,gt,1,1,"ng-template",4)(5,vt,1,1,"ng-template",5)(6,wt,1,1,"ng-template",6),c()),e&2&&(l("ngIf",r.stores.length),f(),l("ngIf",r.tags.length),f(),l("ngIf",r.available),f(),l("title",r.title)("columns",r.columns)("config",r.config)("rows",r.products))},dependencies:[Y,q,T,Q,K]})}}return i})();var bt=[{path:"",component:it}],Ut=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=D({type:i})}static{this.\u0275inj=N({imports:[B.forChild(bt),X]})}}return i})();export{Ut as ProductsModule};
