import{a as Z}from"./chunk-LVMI42ZP.js";import{a as J}from"./chunk-DZVV4JSR.js";import{a as X}from"./chunk-YE5FV3IB.js";import{g as Q}from"./chunk-C3S2QHG2.js";import"./chunk-TGKOXAGH.js";import{C as f,D as o,Ga as $,H as k,J as p,Ka as q,O as c,P as m,Ra as B,T as C,U as h,V as d,Wa as G,Xa as H,Ya as y,_a as S,a as V,b as N,ca as _,da as P,db as R,ea as L,eb as I,gb as x,jb as U,l as M,lb as W,m as F,mb as Y,n as A,o as b,p as D,pb as z,qb as K,t as g,u as v,ua as O}from"./chunk-2AZ5U4IF.js";var w=(()=>{let r=class r{new(){return{}}constructor(e,t){this.mongo=e,this.alert=t,this.articles=[],this._articles={},this.articles=e.get("article",{query:{isTemplate:i=>i.isTemplate,isNotTemplate:i=>!i.isTemplate}},(i,a)=>{this._articles=a})}create(e=this.new(),t=a=>{},i="article has been created."){e._id?this.save(e):this.mongo.create("article",e,a=>{t(a),this.alert.show({text:i})})}doc(e){return this._articles[e]||(this._articles[e]=this.mongo.fetch("article",{query:{_id:e}})),this._articles[e]}update(e,t=a=>{},i="article has been updated."){this.mongo.afterWhile(e,()=>{this.save(e,t,i)})}save(e,t=a=>{},i="article has been updated."){this.mongo.update("article",e,()=>{i&&this.alert.show({text:i,unique:e})})}delete(e,t=a=>{},i="article has been deleted."){this.mongo.delete("article",e,()=>{i&&this.alert.show({text:i})})}};r.\u0275fac=function(t){return new(t||r)(A(y),A(S))},r.\u0275prov=M({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var ee=(()=>{let r=class r{constructor(e){this._as=e,this.chatGPT="[{name: 'Entity Name'}]",this.entities=""}create(){let e=JSON.parse(this.entities);for(let t of e)t.tags=this.tag?[this.tag]:[],this._as.create(t)}};r.\u0275fac=function(t){return new(t||r)(o(w))},r.\u0275cmp=b({type:r,selectors:[["app-articles-create"]],decls:9,vars:1,consts:[["placeholder","Provide array of Articles",3,"wChange"],[3,"click"]],template:function(t,i){t&1&&(c(0,"h1"),_(1,"Create Articles"),m(),c(2,"winput",0),h("wChange",function(T){return i.entities=T}),m(),c(3,"wbutton",1),h("click",function(){return i.create(),i.close()}),_(4,"Create"),m(),c(5,"div"),_(6,"Drop next text to chatGPT to inform him what data he should create. After that you can inform him what you need to be created"),m(),c(7,"pre"),_(8),m()),t&2&&(f(8),P(i.chatGPT))},dependencies:[I,x]});let s=r;return s})();function de(s,r){if(s&1){let n=C();c(0,"wselect",6),h("modelChange",function(t){g(n);let i=d();return v(i.setStore(t))}),m()}if(s&2){let n=d();p("clearable",!0)("items",n.stores)("select",n.store)}}function ue(s,r){if(s&1){let n=C();c(0,"wselect",7),h("modelChange",function(t){g(n);let i=d();return v(i.setTag(t))}),m()}if(s&2){let n=d();p("clearable",!0)("items",n.tags)("select",n.tag)}}function fe(s,r){if(s&1&&(c(0,"div"),_(1),m()),s&2){let n=d();f(),L("articles would be shown also on ",n.available,"")}}function _e(s,r){if(s&1){let n=C();c(0,"winput",8),h("wChange",function(t){let i=g(n).$implicit,a=d();return i.enabled=t,v(a.update(i))}),m()}if(s&2){let n=r.$implicit;p("value",n.enabled)}}function ge(s,r){if(s&1){let n=C();c(0,"winput",8),h("wChange",function(t){let i=g(n).$implicit,a=d();return i.top=t,v(a.update(i))}),m()}if(s&2){let n=r.$implicit;p("value",n.top)}}var te=(()=>{let r=class r{get title(){return this._router.url==="/admin/noveltys"?"Noveltys":this._router.url==="/admin/noveltylinks"?"Articles Links":"Articles"}setArticles(){this.articles.splice(0,this.articles.length);for(let e of this._as.articles)e.tags=e.tags||[],this.tag?e.tags.includes(this.tag)&&this.articles.push(e):this.articles.push(e)}update(e){this._as.update(e)}tagIncludeStore(e){if(e.stores.includes(this.store))return!0;for(;e.parent;)if(e=this._ts.doc(e.parent),e.stores.includes(this.store))return!0;return!1}setTags(){this.tags=[];for(let e of this._ts.tags)e.stores=e.stores||[],(!this.store||this.tagIncludeStore(e))&&this.tags.push(N(V({},e),{name:this.tagName(e)}));this.tags.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.setArticles()}setTag(e){if(this._store.set("tag",e),this.tag=e,this.available="",e){let t=this._ts.doc(e);for(;t.parent;)t=this._ts.doc(t.parent),this.available+=(this.available?", ":"")+t.name}this.setArticles()}tagName(e){let t=e.name;for(;e.parent;)e=this._ts.doc(e.parent),t=e.name+" / "+t;return t}get stores(){return this._ss.stores}setStore(e){this.store=e,this._store.set("store",e),this.setTags()}constructor(e,t,i,a,T,ie,re,se,ne,oe,ae,le,ce){this._form=e,this._as=t,this._alert=i,this._translate=a,this._core=T,this._router=ie,this._modal=re,this._mongo=se,this._ss=ne,this._store=oe,this._http=ae,this._ts=le,this._us=ce,this.columns=["enabled","top","name","short"],this.form=this._form.getForm("article",{formId:"article",title:"Article",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill article title"},{name:"Label",value:"Title"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Text",key:"short",fields:[{name:"Placeholder",value:"fill article short description"},{name:"Label",value:"Short Description"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill article description"},{name:"Label",value:"Description"}]},{name:"Text",key:"reference",fields:[{name:"Placeholder",value:"fill article reference"},{name:"Label",value:"Reference"}]},{name:"Select",key:"tags",fields:[{name:"Placeholder",value:"fill product tag"},{name:"Label",value:"Tag"},{name:"Multiple",value:!0},{name:"Items",value:this._ts.tags}]}]}),this.config={create:this._router.url==="/admin/noveltylinks"?null:()=>{this._form.modal(this.form,{label:"Create",click:(l,u)=>{l.isTemplate=this._router.url==="/admin/noveltys",this._as.create(l,this.setArticles.bind(this)),u()}},this.tag?{tags:[this.tag]}:{})},update:this._router.url==="/admin/noveltylinks"?null:l=>{this._form.modal(this.form,[],l).then(u=>{this._core.copy(u,l),this._as.save(l)})},delete:this._router.url==="/admin/noveltylinks"?null:l=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this article?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._as.delete(l)}}]})},buttons:this._router.url==="/admin/noveltylinks"?null:[{icon:"cloud_download",click:l=>{this._form.modalUnique("article","url",l)}}],headerButtons:this._router.url==="/manage/articles"?null:[this._us.role("admin")||this._us.role("agent")?{icon:"add_circle",click:()=>{this._modal.show({component:ee,tag:this.tag})}}:null]},this.links=[],this.articles=[],this.tags=[],this._store.get("store",this.setStore.bind(this)),this._store.get("tag",this.setTag.bind(this)),this._mongo.on("tag",this.setTags.bind(this)),this._mongo.on("product",this.setArticles.bind(this)),this._router.url==="/admin/noveltylinks"?this._http.get("/api/article/getlinks",l=>{l.forEach(u=>this.links.push(u))}):this._router.url==="/admin/articles"&&this._http.get("/api/article/getadmin",l=>{l.forEach(u=>this.links.push(u))})}};r.\u0275fac=function(t){return new(t||r)(o(W),o(w),o(S),o(R),o(B),o($),o(U),o(y),o(X),o(G),o(H),o(Z),o(J))},r.\u0275cmp=b({type:r,selectors:[["ng-component"]],decls:6,vars:7,consts:[["placeholder","Select store","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],["placeholder","Select tag","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],[4,"ngIf"],[3,"title","columns","config","rows"],["cell","enabled"],["cell","top"],["placeholder","Select store",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["placeholder","Select tag",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["type","checkbox",3,"wChange","value"]],template:function(t,i){t&1&&(k(0,de,1,3,"wselect",0)(1,ue,1,3,"wselect",1)(2,fe,2,1,"div",2),c(3,"wtable",3),k(4,_e,1,1,"ng-template",4)(5,ge,1,1,"ng-template",5),m()),t&2&&(p("ngIf",i.stores.length),f(),p("ngIf",i.tags.length),f(),p("ngIf",i.available),f(),p("title",i.title)("columns",i.columns)("config",i.config)("rows",i.articles))},dependencies:[Y,O,x,K,z]});let s=r;return s})();var ve=[{path:"",component:te}],Ge=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=D({type:r}),r.\u0275inj=F({imports:[q.forChild(ve),Q]});let s=r;return s})();export{Ge as ArticlesModule};
