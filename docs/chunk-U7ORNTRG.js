import{a as X}from"./chunk-LOBGJIEH.js";import{a as Q}from"./chunk-NN7DSGKL.js";import{a as H}from"./chunk-U7JCZEQ7.js";import{g as K}from"./chunk-ABGPTASO.js";import"./chunk-2YKZWEXU.js";import{D as u,E as s,Ga as O,H as A,J as c,Ka as $,O as a,P as l,Ra as q,T as C,U as m,V as p,Wa as B,Xa as G,Ya as y,_a as S,a as E,b as M,ca as f,da as D,db as J,ea as P,eb as k,gb as x,jb as R,l as V,lb as U,m as N,mb as W,n as T,o as b,p as F,pb as Y,qb as z,t as g,u as v,ua as L}from"./chunk-HR67YQAP.js";var w=(()=>{class r{new(){return{}}constructor(e,t){this.mongo=e,this.alert=t,this.articles=[],this._articles={},this.articles=e.get("article",{query:{isTemplate:i=>i.isTemplate,isNotTemplate:i=>!i.isTemplate}},(i,n)=>{this._articles=n})}create(e=this.new(),t=n=>{},i="article has been created."){e._id?this.save(e):this.mongo.create("article",e,n=>{t(n),this.alert.show({text:i})})}doc(e){return this._articles[e]||(this._articles[e]=this.mongo.fetch("article",{query:{_id:e}})),this._articles[e]}update(e,t=n=>{},i="article has been updated."){this.mongo.afterWhile(e,()=>{this.save(e,t,i)})}save(e,t=n=>{},i="article has been updated."){this.mongo.update("article",e,()=>{i&&this.alert.show({text:i,unique:e})})}delete(e,t=n=>{},i="article has been deleted."){this.mongo.delete("article",e,()=>{i&&this.alert.show({text:i})})}static{this.\u0275fac=function(t){return new(t||r)(T(y),T(S))}}static{this.\u0275prov=V({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Z=(()=>{class r{constructor(e){this._as=e,this.chatGPT="[{name: 'Entity Name'}]",this.entities=""}create(){let e=JSON.parse(this.entities);for(let t of e)t.tags=this.tag?[this.tag]:[],this._as.create(t)}static{this.\u0275fac=function(t){return new(t||r)(s(w))}}static{this.\u0275cmp=b({type:r,selectors:[["app-articles-create"]],decls:9,vars:1,consts:[["placeholder","Provide array of Articles",3,"wChange"],[3,"click"]],template:function(t,i){t&1&&(a(0,"h1"),f(1,"Create Articles"),l(),a(2,"winput",0),m("wChange",function(h){return i.entities=h}),l(),a(3,"wbutton",1),m("click",function(){return i.create(),i.close()}),f(4,"Create"),l(),a(5,"div"),f(6,"Drop next text to chatGPT to inform him what data he should create. After that you can inform him what you need to be created"),l(),a(7,"pre"),f(8),l()),t&2&&(u(8),D(i.chatGPT))},dependencies:[k,x]})}}return r})();function he(r,_){if(r&1){let e=C();a(0,"wselect",6),m("modelChange",function(i){g(e);let n=p();return v(n.setStore(i))}),l()}if(r&2){let e=p();c("clearable",!0)("items",e.stores)("select",e.store)}}function de(r,_){if(r&1){let e=C();a(0,"wselect",7),m("modelChange",function(i){g(e);let n=p();return v(n.setTag(i))}),l()}if(r&2){let e=p();c("clearable",!0)("items",e.tags)("select",e.tag)}}function ue(r,_){if(r&1&&(a(0,"div"),f(1),l()),r&2){let e=p();u(),P("articles would be shown also on ",e.available,"")}}function fe(r,_){if(r&1){let e=C();a(0,"winput",8),m("wChange",function(i){let n=g(e).$implicit,h=p();return n.enabled=i,v(h.update(n))}),l()}if(r&2){let e=_.$implicit;c("value",e.enabled)}}function _e(r,_){if(r&1){let e=C();a(0,"winput",8),m("wChange",function(i){let n=g(e).$implicit,h=p();return n.top=i,v(h.update(n))}),l()}if(r&2){let e=_.$implicit;c("value",e.top)}}var ee=(()=>{class r{get title(){return this._router.url==="/admin/noveltys"?"Noveltys":this._router.url==="/admin/noveltylinks"?"Articles Links":"Articles"}setArticles(){this.articles.splice(0,this.articles.length);for(let e of this._as.articles)e.tags=e.tags||[],this.tag?e.tags.includes(this.tag)&&this.articles.push(e):this.articles.push(e)}update(e){this._as.update(e)}tagIncludeStore(e){if(e.stores.includes(this.store))return!0;for(;e.parent;)if(e=this._ts.doc(e.parent),e.stores.includes(this.store))return!0;return!1}setTags(){this.tags=[];for(let e of this._ts.tags)e.stores=e.stores||[],(!this.store||this.tagIncludeStore(e))&&this.tags.push(M(E({},e),{name:this.tagName(e)}));this.tags.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.setArticles()}setTag(e){if(this._store.set("tag",e),this.tag=e,this.available="",e){let t=this._ts.doc(e);for(;t.parent;)t=this._ts.doc(t.parent),this.available+=(this.available?", ":"")+t.name}this.setArticles()}tagName(e){let t=e.name;for(;e.parent;)e=this._ts.doc(e.parent),t=e.name+" / "+t;return t}get stores(){return this._ss.stores}setStore(e){this.store=e,this._store.set("store",e),this.setTags()}constructor(e,t,i,n,h,te,ie,re,ne,se,oe,ae,le){this._form=e,this._as=t,this._alert=i,this._translate=n,this._core=h,this._router=te,this._modal=ie,this._mongo=re,this._ss=ne,this._store=se,this._http=oe,this._ts=ae,this._us=le,this.columns=["enabled","top","name","short"],this.form=this._form.getForm("article",{formId:"article",title:"Article",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill article title"},{name:"Label",value:"Title"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Text",key:"short",fields:[{name:"Placeholder",value:"fill article short description"},{name:"Label",value:"Short Description"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill article description"},{name:"Label",value:"Description"}]},{name:"Text",key:"reference",fields:[{name:"Placeholder",value:"fill article reference"},{name:"Label",value:"Reference"}]},{name:"Select",key:"tags",fields:[{name:"Placeholder",value:"fill product tag"},{name:"Label",value:"Tag"},{name:"Multiple",value:!0},{name:"Items",value:this._ts.tags}]}]}),this.config={create:this._router.url==="/admin/noveltylinks"?null:()=>{this._form.modal(this.form,{label:"Create",click:(o,d)=>{o.isTemplate=this._router.url==="/admin/noveltys",this._as.create(o,this.setArticles.bind(this)),d()}},this.tag?{tags:[this.tag]}:{})},update:this._router.url==="/admin/noveltylinks"?null:o=>{this._form.modal(this.form,[],o).then(d=>{this._core.copy(d,o),this._as.save(o)})},delete:this._router.url==="/admin/noveltylinks"?null:o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this article?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._as.delete(o)}}]})},buttons:this._router.url==="/admin/noveltylinks"?null:[{icon:"cloud_download",click:o=>{this._form.modalUnique("article","url",o)}}],headerButtons:this._router.url==="/manage/articles"?null:[this._us.role("admin")||this._us.role("agent")?{icon:"add_circle",click:()=>{this._modal.show({component:Z,tag:this.tag})}}:null]},this.links=[],this.articles=[],this.tags=[],this._store.get("store",this.setStore.bind(this)),this._store.get("tag",this.setTag.bind(this)),this._mongo.on("tag",this.setTags.bind(this)),this._mongo.on("product",this.setArticles.bind(this)),this._router.url==="/admin/noveltylinks"?this._http.get("/api/article/getlinks",o=>{o.forEach(d=>this.links.push(d))}):this._router.url==="/admin/articles"&&this._http.get("/api/article/getadmin",o=>{o.forEach(d=>this.links.push(d))})}static{this.\u0275fac=function(t){return new(t||r)(s(U),s(w),s(S),s(J),s(q),s(O),s(R),s(y),s(Q),s(B),s(G),s(X),s(H))}}static{this.\u0275cmp=b({type:r,selectors:[["ng-component"]],decls:6,vars:7,consts:[["placeholder","Select store","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],["placeholder","Select tag","style","padding-bottom: 10px;",3,"clearable","items","select","modelChange",4,"ngIf"],[4,"ngIf"],[3,"title","columns","config","rows"],["cell","enabled"],["cell","top"],["placeholder","Select store",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["placeholder","Select tag",2,"padding-bottom","10px",3,"modelChange","clearable","items","select"],["type","checkbox",3,"wChange","value"]],template:function(t,i){t&1&&(A(0,he,1,3,"wselect",0)(1,de,1,3,"wselect",1)(2,ue,2,1,"div",2),a(3,"wtable",3),A(4,fe,1,1,"ng-template",4)(5,_e,1,1,"ng-template",5),l()),t&2&&(c("ngIf",i.stores.length),u(),c("ngIf",i.tags.length),u(),c("ngIf",i.available),u(),c("title",i.title)("columns",i.columns)("config",i.config)("rows",i.articles))},dependencies:[W,L,x,z,Y]})}}return r})();var ge=[{path:"",component:ee}],Be=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=F({type:r})}static{this.\u0275inj=N({imports:[$.forChild(ge),K]})}}return r})();export{Be as ArticlesModule};
